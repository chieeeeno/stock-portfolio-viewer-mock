# Feature Specification: 株式ポートフォリオビューワー

**Feature Branch**: `001-stock-portfolio-viewer`
**Created**: 2025-12-06
**Status**: Draft
**Input**: User description: "顧客の保有株式のポートフォリオを表示する簡易なWebアプリケーションを作成"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - ポートフォリオ全体像の確認 (Priority: P1)

顧客が自分の保有株式の全体的な構成を視覚的に理解できるように、ポートフォリオをドーナツ型パイチャートで表示する。パイチャートの中央には資産総額、評価損益額、評価損益率を表示し、顧客が一目で資産の状況を把握できるようにする。

**Why this priority**: これが最も基本的な機能であり、ユーザーが最初に求める情報。ポートフォリオの全体像を把握することで、投資判断の基礎となる情報を提供できる。

**Independent Test**: アプリケーションを開いた際に、パイチャートと中央の数値が正しく表示されることで独立してテスト可能。モックデータを読み込んで表示できれば、この機能単体で価値を提供できる。

**Acceptance Scenarios**:

1. **Given** アプリケーションが起動している、**When** ユーザーがページにアクセスする、**Then** 保有銘柄の構成を示すドーナツ型パイチャートが12時の位置を起点に、保有比率の大きい順に時計回りに表示される
2. **Given** パイチャートが表示されている、**When** ユーザーがパイチャートを見る、**Then** 各銘柄の保有比率に応じたセグメントが異なる色で区別されて表示される
3. **Given** パイチャートが表示されている、**When** ユーザーがパイチャートの中央を見る、**Then** 資産総額（円）、評価損益額（円）、評価損益率（%）が表示される
4. **Given** 評価損益がプラスの場合、**When** ユーザーがパイチャート中央の数値を見る、**Then** 評価損益額・率のテキストが緑色で表示される
5. **Given** 評価損益がマイナスの場合、**When** ユーザーがパイチャート中央の数値を見る、**Then** 評価損益額・率のテキストが赤色で表示される
6. **Given** 評価損益がゼロの場合、**When** ユーザーがパイチャート中央の数値を見る、**Then** 評価損益額・率のテキストがグレー色で表示される

---

### User Story 2 - 保有銘柄詳細情報の確認 (Priority: P2)

顧客が個別の保有銘柄について詳細な情報を確認できるように、パイチャートの下に保有銘柄の一覧を表示する。各銘柄には、ロゴ画像、銘柄名、ティッカーシンボル、評価損益額、評価損益率が含まれる。

**Why this priority**: パイチャートで全体像を把握した後、顧客は個別銘柄の詳細を確認したいというニーズがある。この情報により、どの銘柄が好調/不調かを具体的に把握できる。

**Independent Test**: 銘柄一覧が正しく表示され、各銘柄の情報（ロゴ、名前、ティッカーシンボル、評価損益）が表示されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** パイチャートが表示されている、**When** ユーザーがページを下にスクロールする、**Then** 保有銘柄の一覧が表示される
2. **Given** 銘柄一覧が表示されている、**When** ユーザーが各銘柄を見る、**Then** 各銘柄のロゴ画像、銘柄名、ティッカーシンボル/保有比率（例: VOO / 39.8%）、保有金額、評価損益（例: +12.87%(¥5,242)）が表示される
3. **Given** 銘柄一覧に評価損益がプラスの銘柄がある、**When** ユーザーがその銘柄を見る、**Then** 評価損益額・率のテキストが緑色で表示される
4. **Given** 銘柄一覧に評価損益がマイナスの銘柄がある、**When** ユーザーがその銘柄を見る、**Then** 評価損益額・率のテキストが赤色で表示される

---

### User Story 3 - 特定銘柄へのフォーカス (Priority: P3)

顧客が特定の銘柄に注目したい場合、パイチャートまたは銘柄一覧の銘柄をクリック/タップすることで、その銘柄をフォーカスし、他の銘柄を半透過表示にする。これにより、特定の銘柄の情報を強調して確認できる。

**Why this priority**: 基本的な情報表示ができた上で、さらにユーザー体験を向上させるインタラクティブな機能。特定の銘柄に集中したい場合に便利。

**Independent Test**: パイチャートまたは銘柄一覧の要素をクリック/タップした際に、選択した銘柄がフォーカスされ、他が半透過になることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** パイチャートが表示されている、**When** ユーザーがパイチャートの特定セグメントをクリック/タップする、**Then** そのセグメントがフォーカスされ、他のセグメントは半透過で表示される
2. **Given** パイチャートの特定セグメントがフォーカスされている、**When** ユーザーが銘柄一覧を見る、**Then** フォーカスされた銘柄のみが通常表示され、他の銘柄は半透過で表示される
3. **Given** 特定の銘柄がフォーカスされている、**When** ユーザーがフォーカスされていない要素をクリック/タップする、**Then** フォーカスが解除され、すべての要素が通常表示に戻る
4. **Given** 特定の銘柄がフォーカスされている、**When** ユーザーが別の銘柄をクリック/タップする、**Then** 新しい銘柄がフォーカスされ、以前フォーカスされていた銘柄を含む他の銘柄は半透過で表示される

---

### User Story 4 - モバイルデバイスでの閲覧 (Priority: P2)

顧客がスマートフォンやタブレットなどのモバイルデバイスからでも快適にポートフォリオを確認できるように、レスポンシブデザインに対応する。画面サイズに応じてレイアウトが最適化され、タッチ操作にも対応する。

**Why this priority**: 現代の投資家は外出先でもポートフォリオを確認したいニーズがある。モバイル対応により、いつでもどこでも資産状況を確認できる。

**Independent Test**: 異なる画面サイズ（スマートフォン、タブレット、PC）でアプリケーションを開き、レイアウトが適切に調整されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** スマートフォンでアプリケーションにアクセスしている、**When** ユーザーがページを表示する、**Then** パイチャートと銘柄一覧が画面幅に収まるように最適化されて表示される
2. **Given** タブレットでアプリケーションにアクセスしている、**When** ユーザーがページを表示する、**Then** パイチャートと銘柄一覧が画面幅に収まるように最適化されて表示される
3. **Given** PCでアプリケーションにアクセスしている、**When** ユーザーがページを表示する、**Then** パイチャートと銘柄一覧が適切なレイアウトで表示される
4. **Given** モバイルデバイスでアプリケーションにアクセスしている、**When** ユーザーがパイチャートや銘柄をタップする、**Then** タッチ操作によるフォーカス機能が正しく動作する

---

### User Story 5 - チャートホバーによる詳細情報の確認 (Priority: P3)

顧客がパイチャートの特定セグメントにマウスを乗せた際に、その銘柄の詳細情報をツールチップで即座に確認できる。これにより、クリック操作なしで素早く銘柄情報を把握できる。

**Why this priority**: 基本的な表示機能とインタラクション機能が完成した後の追加UX改善。ホバーによる情報表示は、デスクトップユーザーの操作効率を向上させる。

**Independent Test**: パイチャートセグメントにマウスを乗せた際にツールチップが表示され、マウスを外すと非表示になることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** パイチャートが表示されている、**When** ユーザーがセグメントにマウスを乗せる、**Then** ツールチップに銘柄名、保有金額、保有比率が表示される
2. **Given** ツールチップが表示されている、**When** ユーザーがマウスをセグメントから外す、**Then** ツールチップが非表示になる
3. **Given** ツールチップが表示されている、**When** ユーザーがマウスを別のセグメントに移動する、**Then** 新しいセグメントの情報がツールチップに表示される
4. **Given** モバイルデバイスでパイチャートが表示されている、**When** ユーザーがセグメントをタップする、**Then** ツールチップが表示される（タッチデバイス対応）

---

### User Story 6 - ダークモードでの閲覧 (Priority: P3)

顧客がシステム設定またはブラウザ設定に応じて、ダークモードでポートフォリオを快適に閲覧できる。目の疲れを軽減し、暗い環境でも視認性を確保する。

**Why this priority**: 基本機能がすべて完成した後のアクセシビリティとUX改善。多くのユーザーがダークモードを好むため、対応することでユーザー満足度が向上する。

**Independent Test**: ブラウザまたはOSのダークモード設定を有効にした際に、アプリケーション全体がダークテーマで表示されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** システムがダークモードに設定されている、**When** ユーザーがアプリケーションにアクセスする、**Then** アプリケーション全体がダークテーマで表示される
2. **Given** ダークモードでパイチャートが表示されている、**When** ユーザーがチャートを見る、**Then** 各セグメントの色が暗い背景でも視認可能である
3. **Given** ダークモードで銘柄一覧が表示されている、**When** ユーザーが評価損益を確認する、**Then** 損益色（緑/赤/グレー）が暗い背景でも明確に識別できる
4. **Given** ダークモードでアプリケーションが表示されている、**When** ユーザーがすべてのテキストを確認する、**Then** テキストと背景のコントラスト比がWCAG AA基準（4.5:1以上）を満たしている
5. **Given** システムがライトモードに設定されている、**When** ユーザーがアプリケーションにアクセスする、**Then** アプリケーションは従来通りのライトテーマで表示される

---

### Edge Cases

- **データ取得エラー**: APIからデータ取得に失敗した場合、ユーザーにわかりやすいエラーメッセージを表示する
- **空のポートフォリオ**: 保有銘柄が0件の場合、「保有銘柄がありません」などのメッセージを表示する
- **保有比率が極端に小さい銘柄**: 保有比率が非常に小さい銘柄（例: 0.1%未満）でも、パイチャート上で視認できるように最小サイズを確保する、または一定以下の比率は「その他」としてまとめる
- **数値の桁数が多い場合**: 資産総額や評価損益額が非常に大きな数値の場合、適切にカンマ区切りや単位表示（万円、億円など）で表示する
- **ロゴ画像の読み込みエラー**: 銘柄ロゴ画像の読み込みに失敗した場合、デフォルトの画像またはティッカーシンボルのテキストを表示する
- **ブラウザの互換性**: Google Chrome最新版以外のブラウザでアクセスした場合の動作（仕様では Chrome 最新版での正しい動作を保証）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはJSONファイル（dummy_response.json）をモックデータとして読み込み、顧客の保有株式情報を取得しなければならない
- **FR-002**: システムはドーナツ型パイチャートを表示し、各セグメントは保有銘柄を表し、セグメントのサイズは銘柄の保有比率に対応しなければならない
- **FR-003**: パイチャートは12時の位置を起点とし、保有比率の大きい順に時計回りにセグメントを配置しなければならない
- **FR-004**: パイチャートの中央には、資産総額（円）、評価損益額（円）、評価損益率（%）を表示しなければならない
- **FR-005**: 評価損益がプラスの場合は緑色、マイナスの場合は赤色、ゼロの場合はグレー色でテキストを表示しなければならない
- **FR-006**: パイチャートの下に保有銘柄の一覧を表示し、各銘柄には銘柄ロゴ画像、銘柄名、ティッカーシンボル、保有比率（%）、保有金額（円）、評価損益額（円）、評価損益率（%）を含めなければならない
- **FR-007**: ユーザーがパイチャートのセグメントをクリック/タップした際、そのセグメントをフォーカスし、他のセグメントを半透過表示にしなければならない
- **FR-008**: 銘柄がフォーカスされた場合、銘柄一覧でもフォーカスされた銘柄のみを通常表示し、他の銘柄を半透過表示にしなければならない
- **FR-009**: ユーザーがフォーカスされていない要素をクリック/タップした際、フォーカスを解除しなければならない
- **FR-010**: システムはレスポンシブデザインに対応し、PC、タブレット、スマートフォンの各デバイスで適切に表示しなければならない
- **FR-011**: 数値（資産総額、評価損益額）は適切にフォーマットされ（カンマ区切りなど）、読みやすく表示しなければならない
- **FR-012**: 評価損益率は小数点以下2桁まで表示しなければならない
- **FR-013**: 保有比率は小数点以下1桁まで表示しなければならない
- **FR-014**: パイチャート中央の評価損益表示は「+15.5%(¥15,500)」の形式（率と額を併記）で表示しなければならない
- **FR-015**: 銘柄一覧の評価損益表示は「+12.87%(¥5,242)」の形式（率と額を併記）で表示しなければならない
- **FR-016**: 銘柄一覧のティッカーシンボルと保有比率は「VOO / 39.8%」の形式で表示しなければならない

### Key Entities

- **ポートフォリオ**: 顧客の全体的な資産情報を表す。属性には資産総額、評価損益額、評価損益率、保有銘柄リストが含まれる
- **保有銘柄**: 顧客が保有する個別の株式銘柄を表す。属性には銘柄情報（名前、ティッカーシンボル、ロゴURL）、保有金額、評価損益額、評価損益率、保有比率が含まれる
- **銘柄情報**: 株式銘柄の基本情報を表す。属性には銘柄名、ティッカーシンボル、ロゴURLが含まれる

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーがアプリケーションにアクセスしてから3秒以内にポートフォリオ全体の構成（パイチャート）を視覚的に把握できる
- **SC-002**: ユーザーがパイチャートを見て、どの銘柄が最も大きな割合を占めているかを即座に判断できる
- **SC-003**: ユーザーが評価損益の状況（プラス/マイナス）を色で瞬時に識別できる（緑=プラス、赤=マイナス、グレー=ゼロ）
- **SC-004**: ユーザーが個別銘柄の詳細情報（評価損益額、評価損益率）を銘柄一覧から1回のスクロールで確認できる
- **SC-005**: ユーザーが特定の銘柄にフォーカスする操作を1回のクリック/タップで完了できる
- **SC-006**: モバイルデバイスでアクセスしたユーザーの90%以上が、レイアウトの崩れやタッチ操作の問題なく全機能を利用できる
- **SC-007**: すべての数値（資産額、損益額、比率）が適切にフォーマットされ、読み間違いが発生しない
- **SC-008**: Google Chrome最新版で、すべての機能が仕様通りに動作する

## Assumptions

以下の前提条件のもとで仕様を作成しています:

- **データソース**: dummy_response.json ファイルがプロジェクト内に配置されており、アクセス可能である
- **データ形式**: JSONデータの構造は仕様書に記載された形式に従っている（total_asset_amount, total_gain_amount, total_gain_ratio, holding_assets配列など）
- **ブラウザ**: Google Chrome最新版での動作を保証。他のブラウザでの動作は保証しない
- **ロゴ画像**: 銘柄ロゴのURLは有効であり、画像が取得可能である。取得できない場合はデフォルト表示またはティッカーシンボルで代替する
- **パイチャートライブラリ**: サードパーティ製のグラフライブラリの使用を許可されている
- **色の選択**: 評価損益の色（緑/赤/グレー）は一般的な投資アプリケーションの慣例に従う
- **数値フォーマット**: 日本の慣例に従い、カンマ区切りで表示する（例: 115,500円）
- **レスポンシブデザイン**: モバイルファーストのアプローチで設計し、小さな画面から大きな画面まで対応する
- **パフォーマンス**: 通常のインターネット接続環境（3G以上）を想定し、データ量は小規模（数十銘柄程度）とする
