# Feature Specification: 株式ポートフォリオビューワー

**Feature Branch**: `001-stock-portfolio-viewer`
**Created**: 2025-12-06
**Status**: Draft
**Input**: User description: "顧客の保有株式のポートフォリオを表示する簡易なWebアプリケーションを作成"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - ポートフォリオ全体像の確認 (Priority: P1)

顧客が自分の保有株式の全体的な構成を視覚的に理解できるように、ポートフォリオをドーナツ型パイチャートで表示する。パイチャートの中央には資産総額、評価損益額、評価損益率を表示し、顧客が一目で資産の状況を把握できるようにする。

**Why this priority**: これが最も基本的な機能であり、ユーザーが最初に求める情報。ポートフォリオの全体像を把握することで、投資判断の基礎となる情報を提供できる。

**Independent Test**: アプリケーションを開いた際に、パイチャートと中央の数値が正しく表示されることで独立してテスト可能。モックデータを読み込んで表示できれば、この機能単体で価値を提供できる。

**Acceptance Scenarios**:

1. **Given** アプリケーションが起動している、**When** ユーザーがページにアクセスする、**Then** 保有銘柄の構成を示すドーナツ型パイチャートが12時の位置を起点に、保有比率の大きい順に時計回りに表示される
2. **Given** パイチャートが表示されている、**When** ユーザーがパイチャートを見る、**Then** 各銘柄の保有比率に応じたセグメントが異なる色で区別されて表示される
3. **Given** パイチャートが表示されている、**When** ユーザーがパイチャートの中央を見る、**Then** 資産総額（円）、評価損益額（円）、評価損益率（%）が表示される
4. **Given** 評価損益がプラスの場合、**When** ユーザーがパイチャート中央の数値を見る、**Then** 評価損益額・率のテキストが緑色で表示される
5. **Given** 評価損益がマイナスの場合、**When** ユーザーがパイチャート中央の数値を見る、**Then** 評価損益額・率のテキストが赤色で表示される
6. **Given** 評価損益がゼロの場合、**When** ユーザーがパイチャート中央の数値を見る、**Then** 評価損益額・率のテキストがグレー色で表示される

---

### User Story 2 - 保有銘柄詳細情報の確認 (Priority: P2)

顧客が個別の保有銘柄について詳細な情報を確認できるように、パイチャートの下に保有銘柄の一覧を表示する。各銘柄には、ロゴ画像、銘柄名、ティッカーシンボル、評価損益額、評価損益率が含まれる。

**Why this priority**: パイチャートで全体像を把握した後、顧客は個別銘柄の詳細を確認したいというニーズがある。この情報により、どの銘柄が好調/不調かを具体的に把握できる。

**Independent Test**: 銘柄一覧が正しく表示され、各銘柄の情報（ロゴ、名前、ティッカーシンボル、評価損益）が表示されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** パイチャートが表示されている、**When** ユーザーがページを下にスクロールする、**Then** 保有銘柄の一覧が表示される
2. **Given** 銘柄一覧が表示されている、**When** ユーザーが各銘柄を見る、**Then** 各銘柄のロゴ画像、銘柄名、ティッカーシンボル/保有比率（例: VOO / 39.8%）、保有金額、評価損益（例: +12.87%(¥5,242)）が表示される
3. **Given** 銘柄一覧に評価損益がプラスの銘柄がある、**When** ユーザーがその銘柄を見る、**Then** 評価損益額・率のテキストが緑色で表示される
4. **Given** 銘柄一覧に評価損益がマイナスの銘柄がある、**When** ユーザーがその銘柄を見る、**Then** 評価損益額・率のテキストが赤色で表示される

---

### User Story 3 - 特定銘柄へのフォーカス (Priority: P3)

顧客が特定の銘柄に注目したい場合、パイチャートまたは銘柄一覧の銘柄をクリック/タップすることで、その銘柄をフォーカスし、他の銘柄を半透過表示にする。これにより、特定の銘柄の情報を強調して確認できる。

**Why this priority**: 基本的な情報表示ができた上で、さらにユーザー体験を向上させるインタラクティブな機能。特定の銘柄に集中したい場合に便利。

**Independent Test**: パイチャートまたは銘柄一覧の要素をクリック/タップした際に、選択した銘柄がフォーカスされ、他が半透過になることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** パイチャートが表示されている、**When** ユーザーがパイチャートの特定セグメントをクリック/タップする、**Then** そのセグメントがフォーカスされ、他のセグメントは半透過で表示される
2. **Given** パイチャートの特定セグメントがフォーカスされている、**When** ユーザーが銘柄一覧を見る、**Then** フォーカスされた銘柄のみが通常表示され、他の銘柄は半透過で表示される
3. **Given** 特定の銘柄がフォーカスされている、**When** ユーザーがフォーカスされていない要素をクリック/タップする、**Then** フォーカスが解除され、すべての要素が通常表示に戻る
4. **Given** 特定の銘柄がフォーカスされている、**When** ユーザーが別の銘柄をクリック/タップする、**Then** 新しい銘柄がフォーカスされ、以前フォーカスされていた銘柄を含む他の銘柄は半透過で表示される

---

### User Story 3A - データローディング時のスケルトン表示 (Priority: P2)

顧客がデータ読み込み中でも待ち時間を快適に過ごせるように、ローディング状態ではスケルトンスクリーン（プレースホルダーUI）を表示する。これにより、ユーザーはコンテンツがどのような形で表示されるかを事前に把握でき、体感待ち時間を短縮できる。

**Why this priority**: ローディング状態のUX改善は、ユーザーの離脱を防ぎ、アプリケーションの品質感を向上させる重要な要素。スピナーよりもスケルトンスクリーンの方がユーザー体験が良いとされている。

**Independent Test**: ページ読み込み時またはデータ取得中に、スケルトンスクリーンが表示されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** アプリケーションが起動している、**When** データが読み込み中である、**Then** パイチャートの位置にチャート形状のスケルトンプレースホルダーが表示される
2. **Given** データが読み込み中である、**When** ユーザーが銘柄一覧エリアを見る、**Then** 銘柄カード形状のスケルトンプレースホルダーが複数表示される
3. **Given** スケルトンスクリーンが表示されている、**When** データの読み込みが完了する、**Then** スケルトンスクリーンが実際のコンテンツにスムーズに置き換わる
4. **Given** スケルトンスクリーンが表示されている、**When** ユーザーがスケルトンを見る、**Then** スケルトン要素がアニメーション（パルスまたはシマー効果）で動いていることがわかる

**Design Decision - 見出しの表示方針**:

スケルトン表示時、「保有銘柄」等の見出しテキストはスケルトン化せず、そのまま表示する方針とした。

理由:
1. **ガタツキ防止**: 見出しのテキストとスケルトンバーの幅・高さを完全に一致させるのは困難であり、わずかなズレでもレイアウトのガタツキが発生する
2. **UXの観点**: ユーザーは「何が読み込まれているか」を理解できたほうがストレスが少ない。見出しがあれば「保有銘柄のリストが読み込み中」と理解できる
3. **業界標準**: Twitter、YouTube、Notion等の主要アプリでも、見出しやラベルはそのまま表示し、データ部分のみスケルトン化するパターンが一般的である

---

### User Story 4 - モバイルデバイスでの閲覧 (Priority: P2)

顧客がスマートフォンやタブレットなどのモバイルデバイスからでも快適にポートフォリオを確認できるように、レスポンシブデザインに対応する。画面サイズに応じてレイアウトが最適化され、タッチ操作にも対応する。

**Why this priority**: 現代の投資家は外出先でもポートフォリオを確認したいニーズがある。モバイル対応により、いつでもどこでも資産状況を確認できる。

**Independent Test**: 異なる画面サイズ（スマートフォン、タブレット、PC）でアプリケーションを開き、レイアウトが適切に調整されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** スマートフォンでアプリケーションにアクセスしている、**When** ユーザーがページを表示する、**Then** パイチャートと銘柄一覧が画面幅に収まるように最適化されて表示される
2. **Given** タブレットでアプリケーションにアクセスしている、**When** ユーザーがページを表示する、**Then** パイチャートと銘柄一覧が画面幅に収まるように最適化されて表示される
3. **Given** PCでアプリケーションにアクセスしている、**When** ユーザーがページを表示する、**Then** パイチャートと銘柄一覧が適切なレイアウトで表示される
4. **Given** モバイルデバイスでアプリケーションにアクセスしている、**When** ユーザーがパイチャートや銘柄をタップする、**Then** タッチ操作によるフォーカス機能が正しく動作する
5. **Given** タッチデバイス（スマートフォン・タブレット）でパイチャートが表示されている、**When** ユーザーがパイチャートのセグメントをタップする、**Then** 該当する銘柄のカードまでスムーズスクロールが実行される

**Design Decision - タッチデバイスでのチャート操作**:

PCとタッチデバイスでは操作方法が異なるため、チャートセグメントのインタラクションを以下のように分けて実装する。

| デバイス種別 | 検出方法 | チャートセグメント操作 | ツールチップ |
|-------------|---------|---------------------|-------------|
| 非タッチデバイス（PC） | `navigator.maxTouchPoints === 0` | ホバーでツールチップ表示、クリックでフォーカス | 表示 |
| タッチデバイス | `navigator.maxTouchPoints > 0` | タップで該当銘柄カードへスクロール＋フォーカス | 非表示 |

**実装方針**:
- `useTouchDevice`カスタムフックでタッチデバイスを検出
- タッチデバイスの場合、ツールチップを非表示にする（実装済み→タッチデバイス検出に変更）
- タッチデバイスの場合、チャートセグメントタップ時に該当銘柄カードへスムーズスクロール
- スクロール先の銘柄カードは`data-asset-index`属性で特定
- `scrollIntoView({ behavior: 'smooth', block: 'center' })`でスムーズスクロール

---

### User Story 5 - チャートホバーによる詳細情報の確認 (Priority: P3)

顧客がパイチャートの特定セグメントにマウスを乗せた際に、その銘柄の詳細情報をツールチップで即座に確認できる。これにより、クリック操作なしで素早く銘柄情報を把握できる。

**Why this priority**: 基本的な表示機能とインタラクション機能が完成した後の追加UX改善。ホバーによる情報表示は、デスクトップユーザーの操作効率を向上させる。

**Independent Test**: パイチャートセグメントにマウスを乗せた際にツールチップが表示され、マウスを外すと非表示になることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** パイチャートが表示されている、**When** ユーザーがセグメントにマウスを乗せる、**Then** ツールチップに銘柄名、保有金額、保有比率が表示される
2. **Given** ツールチップが表示されている、**When** ユーザーがマウスをセグメントから外す、**Then** ツールチップが非表示になる
3. **Given** ツールチップが表示されている、**When** ユーザーがマウスを別のセグメントに移動する、**Then** 新しいセグメントの情報がツールチップに表示される
4. **Given** モバイルデバイスでパイチャートが表示されている、**When** ユーザーがセグメントをタップする、**Then** ツールチップが表示される（タッチデバイス対応）

---

### User Story 6 - ダークモードでの閲覧 (Priority: P3)

顧客がグローバルヘッダーに設置されたテーマ切り替えスイッチを使用して、ライトモードとダークモードを手動で切り替えられる。また、初回アクセス時はシステム設定を尊重し、以降はユーザーの選択をlocalStorageに保存して永続化する。目の疲れを軽減し、暗い環境でも視認性を確保する。

**Why this priority**: 基本機能がすべて完成した後のアクセシビリティとUX改善。多くのユーザーがダークモードを好むため、対応することでユーザー満足度が向上する。手動切り替え機能により、ユーザーが好みのテーマを選択できる。

**Independent Test**: ヘッダーのテーマ切り替えスイッチをクリックした際に、アプリケーション全体のテーマが切り替わることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** アプリケーションが起動している、**When** ユーザーがページにアクセスする、**Then** 画面上部にグローバルヘッダーが表示され、テーマ切り替えスイッチ（トグルボタン）が配置されている
2. **Given** ライトモードでアプリケーションが表示されている、**When** ユーザーがテーマ切り替えスイッチをクリックする、**Then** アプリケーション全体がダークテーマに切り替わり、スイッチの状態も変化する
3. **Given** ダークモードでアプリケーションが表示されている、**When** ユーザーがテーマ切り替えスイッチをクリックする、**Then** アプリケーション全体がライトテーマに切り替わり、スイッチの状態も変化する
4. **Given** ユーザーがテーマを切り替えた、**When** ユーザーがページをリロードまたは再訪問する、**Then** 以前選択したテーマが維持されている（localStorageに保存）
5. **Given** localStorageにテーマ設定がない（初回アクセス）、**When** ユーザーがアプリケーションにアクセスする、**Then** システムのダークモード設定（prefers-color-scheme）に従ってテーマが決定される
6. **Given** ダークモードでパイチャートが表示されている、**When** ユーザーがチャートを見る、**Then** 各セグメントの色が暗い背景でも視認可能である
7. **Given** ダークモードで銘柄一覧が表示されている、**When** ユーザーが評価損益を確認する、**Then** 損益色（緑/赤/グレー）が暗い背景でも明確に識別できる
8. **Given** ダークモードでアプリケーションが表示されている、**When** ユーザーがすべてのテキストを確認する、**Then** テキストと背景のコントラスト比がWCAG AA基準（4.5:1以上）を満たしている
9. **Given** グローバルヘッダーが表示されている、**When** ユーザーが任意の画面サイズでアクセスする、**Then** ヘッダーはレスポンシブに対応し、適切に表示される
10. **Given** ダークモードでアプリケーションが表示されている、**When** ユーザーがテーマ切り替えスイッチをクリックする、**Then** チャートの色も含めすべてのコンポーネントが即座にライトモードに連動して切り替わる
11. **Given** グローバルヘッダーが表示されている、**When** ユーザーがヘルプアイコンボタンにマウスを乗せる、**Then** 「ヘルプを表示する」というツールチップが表示される
12. **Given** ライトモードでグローバルヘッダーが表示されている、**When** ユーザーがテーマ切り替えボタンにマウスを乗せる、**Then** 「ダークモードに切り替える」というツールチップが表示される
13. **Given** ダークモードでグローバルヘッダーが表示されている、**When** ユーザーがテーマ切り替えボタンにマウスを乗せる、**Then** 「ライトモードに切り替える」というツールチップが表示される

**Design Decision - ヘッダーボタンのツールチップ実装（検討中）**:

ヘッダーボタン（ヘルプアイコン、テーマ切り替え）のツールチップ実装には、以下のライブラリを候補として検討する。

**選定候補**:

| ライブラリ | 特徴 | 検討ポイント |
|-----------|------|-------------|
| **shadcn/ui** | Radix UIベースのコンポーネント集。Tailwind CSSと親和性が高い | 第一候補。アクセシビリティ対応、カスタマイズ性が高い |
| **Radix UI** | ヘッドレスUIライブラリ。shadcn/uiの基盤 | shadcn/uiを使わない場合の選択肢 |
| **Floating UI** | ツールチップ・ポップオーバーの位置計算に特化 | 軽量、低レベルAPI |
| **自前実装** | CSS + React stateのみで実装 | 依存なし、シンプルな要件なら十分 |

**選定基準**:
1. バンドルサイズへの影響
2. 既存のTailwind CSS環境との親和性
3. アクセシビリティ（WAI-ARIA対応）
4. ダークモード対応の容易さ
5. プロジェクトの他のUI要件との整合性

**注記**: 実装フェーズで最終的なライブラリを決定し、選定理由を本セクションに追記する。

**Design Decision - テーマ状態管理のアーキテクチャ**:

テーマ状態はReact Contextを使用してアプリケーション全体で共有する方針とした。

理由:
1. **状態の一元管理**: テーマ設定は複数のコンポーネント（ThemeToggle、PortfolioChart、AssetCard等）で参照されるため、単一のソースから状態を配信する必要がある
2. **リアルタイム同期**: ユーザーがThemeToggleでテーマを切り替えた際、すべてのコンポーネントが即座に新しいテーマを反映する必要がある
3. **永続化との連携**: localStorageへの保存とReact状態の同期を一箇所で管理することで、整合性を保証しやすい

実装の構成:
- `ThemeProvider`: Context Providerコンポーネント。ルートレイアウトで使用
- `useTheme`: Context からテーマ状態を取得するカスタムフック
- `useChartColors`: テーマに応じたチャートカラー配列を返すカスタムフック

初期化フロー:
1. ページ読み込み時: FOUC防止スクリプトがlocalStorageを読み、DOMにdarkクラスを即時適用
2. Reactハイドレーション後: ThemeProviderがlocalStorageから状態を読み込みContextに設定
3. 各コンポーネント: useTheme/useChartColorsでContextを購読し、テーマに応じた表示を行う

**Design Decision - チャートカラーのテーマ対応**:

ライトモードとダークモードで異なるカラーパレットを使用する方針とした。

| モード | カラー系統 | 理由 |
|--------|------------|------|
| ライトモード | 500系（鮮やか） | 明るい背景に対して適切なコントラスト |
| ダークモード | 400系（彩度控えめ） | 暗い背景での目の疲れを軽減し、可読性を向上 |

実装:
- `CHART_COLORS_LIGHT`: ライトモード用パレット（blue-500, emerald-500, etc.）
- `CHART_COLORS_DARK`: ダークモード用パレット（blue-400, emerald-400, etc.）
- `useChartColors`: テーマに応じて適切なパレットを返す

---

### User Story 6A - ユーザーメニュー (Priority: P3)

顧客がヘッダーのユーザーアイコンをクリックすることで、ユーザー関連の操作メニュー（ドロップダウン）を表示できる。メニューにはログアウトリンクが含まれる（本モックでは実際のログアウト機能は動作しない）。

**Why this priority**: ヘッダーの基本機能（テーマ切り替え、ヘルプボタン）が完成した後の追加UI要素。実際のアプリケーションでは必須だが、モック実装では見た目のみの対応で十分。

**Independent Test**: ユーザーアイコンをクリックした際にドロップダウンメニューが表示され、メニュー外をクリックすると閉じることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** グローバルヘッダーが表示されている、**When** ユーザーがユーザーアイコンをクリックする、**Then** ドロップダウンメニューが表示される
2. **Given** ドロップダウンメニューが表示されている、**When** ユーザーがメニュー内を見る、**Then** 「ログアウト」リンクが表示されている
3. **Given** ドロップダウンメニューが表示されている、**When** ユーザーが「ログアウト」リンクをクリックする、**Then** 何も起こらない（モック実装のため機能しない）
4. **Given** ドロップダウンメニューが表示されている、**When** ユーザーがメニュー外の領域をクリックする、**Then** ドロップダウンメニューが閉じる
5. **Given** ドロップダウンメニューが表示されている、**When** ユーザーがEscキーを押す、**Then** ドロップダウンメニューが閉じる
6. **Given** グローバルヘッダーが表示されている、**When** ユーザーがユーザーアイコンにマウスを乗せる、**Then** 「ユーザーメニュー」というツールチップが表示される

**Design Decision - ドロップダウン実装**:

ユーザーメニューのドロップダウンはshadcn/uiのDropdown Menuコンポーネントをベースに、プロジェクトのデザインに合わせてスタイリングを調整して実装する。

理由:
1. **既存依存との整合性**: プロジェクトで既にshadcn/uiが初期化されており（Tooltipで使用）、同じUIライブラリで統一できる
2. **アクセシビリティ**: Radix UIベースのためWAI-ARIA準拠のキーボード操作、フォーカス管理が標準で提供される
3. **カスタマイズ性**: shadcn/uiはコピー&ペースト方式のため、プロジェクトのデザインに合わせて自由にスタイリング調整が可能

---

### User Story 7 - 初回訪問時のオンボーディングガイド (Priority: P3)

初めてアプリケーションを訪問した顧客が、主要な機能や操作方法を迅速に理解できるように、インタラクティブなオンボーディングガイドを表示する。ステップバイステップのガイドにより、ユーザーはパイチャートの見方、銘柄一覧の情報、フォーカス機能などを自然に学習できる。

**Why this priority**: 基本機能とUX改善機能がすべて完成した後の付加価値機能。新規ユーザーの初期体験を向上させ、アプリケーションの価値を最大限に引き出すための補助機能。

**Independent Test**: 初回アクセス時にオンボーディングガイドが自動的に開始され、各ステップでUI要素がハイライトされ、ガイドをスキップ・完了できることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** ユーザーが初めてアプリケーションにアクセスする（localStorageにオンボーディング完了フラグがない）、**When** ページの読み込みが完了する、**Then** オンボーディングガイドが自動的に開始される
2. **Given** オンボーディングガイドが開始されている、**When** 各ステップが表示される、**Then** 対象のUI要素（パイチャート、中央の数値、銘柄一覧など）がハイライト表示され、他の領域はオーバーレイで暗くなる
3. **Given** オンボーディングガイドのステップが表示されている、**When** ユーザーが「次へ」ボタンをクリックする、**Then** 次のステップに進み、対応するUI要素がハイライトされる
4. **Given** オンボーディングガイドのステップが表示されている、**When** ユーザーが「前へ」ボタンをクリックする、**Then** 前のステップに戻り、対応するUI要素がハイライトされる
5. **Given** オンボーディングガイドが表示されている、**When** ユーザーが「スキップ」ボタンをクリックする、**Then** ガイドが終了し、完了フラグがlocalStorageに保存される
6. **Given** オンボーディングガイドの最後のステップが表示されている、**When** ユーザーが「完了」ボタンをクリックする、**Then** ガイドが終了し、完了フラグがlocalStorageに保存される
7. **Given** オンボーディングを完了またはスキップしたユーザー、**When** ユーザーが再度アプリケーションにアクセスする、**Then** オンボーディングガイドは自動的に開始されない
8. **Given** オンボーディングを完了またはスキップしたユーザー、**When** ユーザーがヘッダーの「ガイドを再表示」ボタンをクリックする、**Then** オンボーディングガイドが再度開始される
9. **Given** オンボーディングガイドが表示されている、**When** ユーザーがキーボードでEscキーを押す、**Then** ガイドが終了する
10. **Given** オンボーディングガイドが表示されている、**When** ユーザーがキーボードで右矢印キーを押す、**Then** 次のステップに進む
11. **Given** オンボーディングガイドが表示されている、**When** ユーザーがキーボードで左矢印キーを押す、**Then** 前のステップに戻る

**Design Decision - オンボーディングライブラリの選定**:

オンボーディング機能の実装には **driver.js** を採用する。

**選定候補と比較**:

| ライブラリ | GitHub Stars | 週間DL | バンドルサイズ | React統合 | 依存関係 |
|-----------|-------------|--------|---------------|-----------|---------|
| **driver.js** | ~25,000 ⭐ | ~255,000 | 5kb (gzip) | ラッパー必要 | なし |
| react-joyride | ~7,500 | ~490,000 | 中程度 | ネイティブ | react-floater |
| intro.js | ~23,700 | ~140,000 | 12kb+ (gzip) | ラッパー必要 | なし |

**driver.js を選定した理由**:

1. **人気と信頼性**: GitHubスター数が最多（25k）で、活発にメンテナンスされている
2. **軽量性**: バンドルサイズが5kb（gzip）と最も小さく、パフォーマンスへの影響が最小限
3. **ゼロ依存**: 外部依存がなく、バンドルサイズの肥大化やバージョン競合のリスクがない
4. **高いカスタマイズ性**: ポップオーバーの配置、スタイリング、アニメーションを柔軟にカスタマイズ可能
5. **TypeScript対応**: 完全な型定義が提供されている
6. **アクセシビリティ**: キーボード操作（矢印キー、Escキー）に対応

**react-joyrideを選定しなかった理由**:
- react-floaterへの依存があり、依存関係が増える
- バンドルサイズがdriver.jsより大きい

**intro.jsを選定しなかった理由**:
- バンドルサイズがdriver.jsの2倍以上（12kb+ vs 5kb）
- TypeScript対応が部分的

**実装方針**:
- driver.jsをラップするカスタムフック `useOnboarding` を作成
- オンボーディングステップの定義は定数ファイルで管理
- 完了/スキップ状態はlocalStorageで永続化

**オンボーディングステップ構成**:

| ステップ | 対象要素 | 説明内容 |
|---------|---------|---------|
| 1 | パイチャート全体 | 「ポートフォリオの構成を円グラフで表示しています。各セグメントは保有銘柄を表します。」 |
| 2 | パイチャート中央 | 「中央には資産総額と評価損益が表示されます。緑色はプラス、赤色はマイナスを示します。」 |
| 3 | 銘柄一覧 | 「各銘柄の詳細情報を確認できます。ロゴ、銘柄名、保有比率、評価損益が表示されます。」 |
| 4 | パイチャートセグメント | 「セグメントをクリックすると、その銘柄にフォーカスできます。」 |
| 5 | テーマ切り替えスイッチ | 「こちらでライトモード/ダークモードを切り替えられます。」 |

---

### Edge Cases

- **データ取得エラー**: APIからデータ取得に失敗した場合、ユーザーにわかりやすいエラーメッセージを表示する
- **空のポートフォリオ**: 保有銘柄が0件の場合、「保有銘柄がありません」などのメッセージを表示する
- **保有比率が極端に小さい銘柄**: 保有比率が非常に小さい銘柄（例: 0.1%未満）でも、パイチャート上で視認できるように最小サイズを確保する、または一定以下の比率は「その他」としてまとめる
- **数値の桁数が多い場合**: 資産総額や評価損益額が非常に大きな数値の場合、適切にカンマ区切りや単位表示（万円、億円など）で表示する
- **ロゴ画像の読み込みエラー**: 銘柄ロゴ画像の読み込みに失敗した場合、デフォルトの画像またはティッカーシンボルのテキストを表示する
- **ブラウザの互換性**: Google Chrome最新版以外のブラウザでアクセスした場合の動作（仕様では Chrome 最新版での正しい動作を保証）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはJSONファイル（dummy_response.json）をモックデータとして読み込み、顧客の保有株式情報を取得しなければならない
- **FR-002**: システムはドーナツ型パイチャートを表示し、各セグメントは保有銘柄を表し、セグメントのサイズは銘柄の保有比率に対応しなければならない
- **FR-003**: パイチャートは12時の位置を起点とし、保有比率の大きい順に時計回りにセグメントを配置しなければならない
- **FR-004**: パイチャートの中央には、資産総額（円）、評価損益額（円）、評価損益率（%）を表示しなければならない
- **FR-005**: 評価損益がプラスの場合は緑色、マイナスの場合は赤色、ゼロの場合はグレー色でテキストを表示しなければならない
- **FR-006**: パイチャートの下に保有銘柄の一覧を表示し、各銘柄には銘柄ロゴ画像、銘柄名、ティッカーシンボル、保有比率（%）、保有金額（円）、評価損益額（円）、評価損益率（%）を含めなければならない
- **FR-007**: ユーザーがパイチャートのセグメントをクリック/タップした際、そのセグメントをフォーカスし、他のセグメントを半透過表示にしなければならない
- **FR-008**: 銘柄がフォーカスされた場合、銘柄一覧でもフォーカスされた銘柄のみを通常表示し、他の銘柄を半透過表示にしなければならない
- **FR-009**: ユーザーがフォーカスされていない要素をクリック/タップした際、フォーカスを解除しなければならない
- **FR-010**: システムはレスポンシブデザインに対応し、PC、タブレット、スマートフォンの各デバイスで適切に表示しなければならない
- **FR-011**: 数値（資産総額、評価損益額）は適切にフォーマットされ（カンマ区切りなど）、読みやすく表示しなければならない
- **FR-012**: 評価損益率は小数点以下2桁まで表示しなければならない
- **FR-013**: 保有比率は小数点以下1桁まで表示しなければならない
- **FR-014**: パイチャート中央の評価損益表示は「+15.5%(¥15,500)」の形式（率と額を併記）で表示しなければならない
- **FR-015**: 銘柄一覧の評価損益表示は「+12.87%(¥5,242)」の形式（率と額を併記）で表示しなければならない
- **FR-016**: 銘柄一覧のティッカーシンボルと保有比率は「VOO / 39.8%」の形式で表示しなければならない
- **FR-017**: システムは画面上部にグローバルヘッダーを表示し、テーマ切り替えスイッチ（トグルボタン）を配置しなければならない
- **FR-018**: ユーザーがテーマ切り替えスイッチをクリック/タップした際、ライトモードとダークモードを切り替えなければならない
- **FR-019**: ユーザーが選択したテーマ設定はlocalStorageに保存され、ページリロード時も維持されなければならない
- **FR-020**: localStorageにテーマ設定がない初回アクセス時は、システムのダークモード設定（prefers-color-scheme）に従ってテーマを決定しなければならない
- **FR-021**: グローバルヘッダーはすべての画面サイズ（モバイル、タブレット、PC）でレスポンシブに対応しなければならない
- **FR-022**: システムはデータ読み込み中にスケルトンスクリーン（プレースホルダーUI）を表示しなければならない
- **FR-023**: スケルトンスクリーンはパイチャート領域用のチャートスケルトンと銘柄一覧用のカードスケルトンを含まなければならない
- **FR-024**: スケルトン要素はアニメーション効果（パルスまたはシマー）を持ち、ローディング中であることを視覚的に示さなければならない
- **FR-025**: データ読み込み完了時、スケルトンスクリーンから実際のコンテンツへスムーズに遷移しなければならない
- **FR-026**: システムは初回訪問時（localStorageにオンボーディング完了フラグがない場合）にオンボーディングガイドを自動的に開始しなければならない
- **FR-027**: オンボーディングガイドは対象のUI要素をハイライト表示し、他の領域をオーバーレイで暗くしなければならない
- **FR-028**: オンボーディングガイドは「次へ」「前へ」ボタンによるステップ間のナビゲーションを提供しなければならない
- **FR-029**: オンボーディングガイドは「スキップ」ボタンによりガイドを途中終了できなければならない
- **FR-030**: オンボーディングガイドの完了またはスキップ状態はlocalStorageに保存され、再訪問時に自動開始を防がなければならない
- **FR-031**: システムはヘッダーに「ガイドを再表示」ボタンを配置し、ユーザーが任意のタイミングでオンボーディングを再開できなければならない
- **FR-032**: オンボーディングガイドはキーボード操作（Escキーで終了、矢印キーでナビゲーション）に対応しなければならない
- **FR-033**: ヘッダーのヘルプアイコンボタンにマウスホバーした際、「ヘルプを表示する」というツールチップを表示しなければならない
- **FR-034**: ヘッダーのテーマ切り替えボタンにマウスホバーした際、現在のテーマに応じて「ライトモードに切り替える」または「ダークモードに切り替える」というツールチップを表示しなければならない
- **FR-035**: システムはヘッダーにユーザーアイコンを配置し、クリック時にドロップダウンメニューを表示しなければならない
- **FR-036**: ユーザーメニューのドロップダウンには「ログアウト」リンクを含めなければならない（モック実装のため実際の機能は動作しない）
- **FR-037**: ユーザーメニューのドロップダウンは、メニュー外のクリックまたはEscキー押下で閉じなければならない
- **FR-038**: ヘッダーのユーザーアイコンにマウスホバーした際、「ユーザーメニュー」というツールチップを表示しなければならない

### Key Entities

- **ポートフォリオ**: 顧客の全体的な資産情報を表す。属性には資産総額、評価損益額、評価損益率、保有銘柄リストが含まれる
- **保有銘柄**: 顧客が保有する個別の株式銘柄を表す。属性には銘柄情報（名前、ティッカーシンボル、ロゴURL）、保有金額、評価損益額、評価損益率、保有比率が含まれる
- **銘柄情報**: 株式銘柄の基本情報を表す。属性には銘柄名、ティッカーシンボル、ロゴURLが含まれる

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーがアプリケーションにアクセスしてから3秒以内にポートフォリオ全体の構成（パイチャート）を視覚的に把握できる
- **SC-002**: ユーザーがパイチャートを見て、どの銘柄が最も大きな割合を占めているかを即座に判断できる
- **SC-003**: ユーザーが評価損益の状況（プラス/マイナス）を色で瞬時に識別できる（緑=プラス、赤=マイナス、グレー=ゼロ）
- **SC-004**: ユーザーが個別銘柄の詳細情報（評価損益額、評価損益率）を銘柄一覧から1回のスクロールで確認できる
- **SC-005**: ユーザーが特定の銘柄にフォーカスする操作を1回のクリック/タップで完了できる
- **SC-006**: モバイルデバイスでアクセスしたユーザーの90%以上が、レイアウトの崩れやタッチ操作の問題なく全機能を利用できる
- **SC-007**: すべての数値（資産額、損益額、比率）が適切にフォーマットされ、読み間違いが発生しない
- **SC-008**: Google Chrome最新版で、すべての機能が仕様通りに動作する

## Assumptions

以下の前提条件のもとで仕様を作成しています:

- **データソース**: dummy_response.json ファイルがプロジェクト内に配置されており、アクセス可能である
- **データ形式**: JSONデータの構造は仕様書に記載された形式に従っている（total_asset_amount, total_gain_amount, total_gain_ratio, holding_assets配列など）
- **ブラウザ**: Google Chrome最新版での動作を保証。他のブラウザでの動作は保証しない
- **ロゴ画像**: 銘柄ロゴのURLは有効であり、画像が取得可能である。取得できない場合はデフォルト表示またはティッカーシンボルで代替する
- **パイチャートライブラリ**: サードパーティ製のグラフライブラリの使用を許可されている
- **色の選択**: 評価損益の色（緑/赤/グレー）は一般的な投資アプリケーションの慣例に従う
- **数値フォーマット**: 日本の慣例に従い、カンマ区切りで表示する（例: 115,500円）
- **レスポンシブデザイン**: モバイルファーストのアプローチで設計し、小さな画面から大きな画面まで対応する
- **パフォーマンス**: 通常のインターネット接続環境（3G以上）を想定し、データ量は小規模（数十銘柄程度）とする
- **オンボーディングライブラリ**: driver.js（v1.x系）を使用。ゼロ依存の軽量ライブラリでキーボード操作に対応
