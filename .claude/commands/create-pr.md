---
description: 現在のブランチの変更をプッシュし、分岐元ブランチに対してPRを作成します
---

# Create Pull Request

現在のブランチの変更をプッシュし、PRを作成してください。

## Step 1: 現在の状態を確認

以下のコマンドを実行して状態を把握：

```bash
# 現在のブランチ名
git branch --show-current

# リモートの確認
git remote -v

# 未コミットの変更があるか確認
git status
```

## Step 2: 分岐元ブランチの特定

**スクリプトを使用して分岐元ブランチを自動検出してください：**

```bash
./scripts/detect-base-branch.sh
```

### スクリプトの検出方法（優先順位順）

1. **git config**: `branch.<name>.baseBranch` に明示的に記録されている場合（信頼度: HIGH）
2. **reflog**: ブランチ作成時の `Created from <branch>` を解析（信頼度: HIGH/MEDIUM）
3. **GitHub PR**: 過去のPR履歴からベースブランチを取得（信頼度: HIGH）
4. **距離計算**: 全ブランチとの共通祖先を計算し最も近いブランチを推測（信頼度: MEDIUM）

### 結果の確認

スクリプトの出力を確認し、ユーザーに確認：

- 信頼度が **HIGH** の場合: そのまま使用可能
- 信頼度が **MEDIUM/LOW** の場合: ユーザーに確認を取る

### 分岐元ブランチの確定

ユーザーが確認したら、今後のために記録：

```bash
./scripts/detect-base-branch.sh --set <確定したブランチ名>
```

### 差分を確認

```bash
# 分岐元からの差分（コミット一覧）
git log --oneline <base-branch>..HEAD

# 分岐元からのファイル差分
git diff --stat <base-branch>..HEAD
```

## Step 3: 未プッシュのコミットをプッシュ

```bash
# 現在のブランチをリモートにプッシュ（上流ブランチ設定）
git push -u origin <現在のブランチ名>
```

**注意**:

- コミットされていない変更がある場合は、ユーザーに確認してからコミットするか判断
- プッシュ前に `git status` で状態を確認

## Step 4: 差分を分析してPR内容を生成

差分の内容を分析し、以下を生成：

### PRタイトル

- 変更の主な目的を簡潔に表現（50文字以内推奨）
- 形式: `<type>: <description>`
  - feat: 新機能
  - fix: バグ修正
  - refactor: リファクタリング
  - docs: ドキュメント
  - test: テスト追加・修正
  - chore: その他

### PR本文

以下の形式で生成：

```markdown
## 概要

[この変更の目的と背景を1-2文で]

## 変更内容

- [主な変更点1]
- [主な変更点2]
- [主な変更点3]

## 技術的な詳細

[実装のアプローチや注意点があれば]

## テスト

- [ ] 単体テスト
- [ ] 動作確認

## スクリーンショット

[UIの変更がある場合]
```

## Step 5: PRを作成

`mcp__github__create_pull_request` を使用してPRを作成：

- **owner**: リモートURLから抽出（例: `tomoki`）
- **repo**: リモートURLから抽出（例: `stock-portfolio-viewer-mock`）
- **title**: Step 4で生成したタイトル
- **body**: Step 4で生成した本文
- **head**: 現在のブランチ名
- **base**: Step 2で特定した分岐元ブランチ

## Step 6: 結果を報告

PRが作成されたら、以下を報告：

- PR URL
- PRタイトル
- ベースブランチ → ヘッドブランチ

---

## 注意事項

- **未コミットの変更がある場合**: ユーザーに確認してからコミットを行う
- **分岐元ブランチの特定**: 必ずユーザーに確認を取ってから決定する
- **コンフリクトの可能性**: ベースブランチとの差分が大きい場合は警告
- **リモートブランチが存在しない場合**: `git push -u origin <branch>` で作成してからPR作成
